name: DCO Check

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  dco:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Verify DCO
        run: |
          FAILED_COMMITS=""
          for commit in $(git rev-list origin/${{ github.base_ref }}..HEAD); do
            if ! git log -1 --format="%B" "$commit" | grep -q "^Signed-off-by:"; then
              FAILED_COMMITS="$FAILED_COMMITS $commit"
            fi
          done
          
          if [ -n "$FAILED_COMMITS" ]; then
            echo "❌ The following commits are missing DCO sign-off:"
            for commit in $FAILED_COMMITS; do
              echo "  - $commit: $(git log -1 --format='%s' $commit)"
            done
            echo ""
            echo "Please sign off your commits using: git commit --amend -s"
            echo "See CONTRIBUTING.md for details."
            exit 1
          else
            echo "✅ All commits are properly signed off."
          fi
