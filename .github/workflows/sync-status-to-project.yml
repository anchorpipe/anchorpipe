name: Sync Status Label to Project

on:
  issues:
    types: [labeled, unlabeled]
  pull_request:
    types: [labeled, unlabeled]

permissions:
  contents: read
  issues: write
  pull-requests: write

jobs:
  sync-status:
    runs-on: ubuntu-latest
    # Only run for status labels
    if: contains(github.event.label.name, 'status:')
    steps:
      - name: Log status label change
        uses: actions/github-script@v8
        with:
          script: |
            const label = context.payload.label?.name;
            const action = context.payload.action; // 'labeled' or 'unlabeled'

            if (!label) {
              core.info('No label found in event');
              return;
            }

            // Map status labels to project status values
            const statusMap = {
              'status:needs-triage': 'ðŸ” Triage',
              'status:needs-refinement': 'ðŸ” Triage',
              'status:ready': 'ðŸ› ï¸ To Do',
              'status:in-progress': 'ðŸ—ï¸ In Progress',
              'status:blocked': 'â¸ï¸ Blocked',
              'status:needs-review': 'ðŸ—ï¸ In Progress',
              'status:done': 'âœ… Done'
            };

            const projectStatus = statusMap[label];

            if (projectStatus) {
              core.info(`${action}: ${label} -> ${projectStatus}`);
              
              // Note: Full implementation requires GitHub Projects API access
              // For now, this workflow logs the change for manual verification
              // To implement full sync:
              // 1. Use GitHub Projects API (requires additional permissions)
              // 2. Update project item field value based on status label
              // 3. Handle project item column moves
              
              core.setOutput('status', projectStatus);
              core.setOutput('action', action);
            } else {
              core.info(`Status label ${label} not mapped to project status`);
            }

      - name: Comment on issue (optional - for verification)
        if: github.event_name == 'issues'
        uses: actions/github-script@v8
        with:
          script: |
            // Uncomment below to add comments for verification
            // const status = core.getOutput('status');
            // if (status) {
            //   github.rest.issues.createComment({
            //     issue_number: context.issue.number,
            //     owner: context.repo.owner,
            //     repo: context.repo.repo,
            //     body: `Status updated: ${status}\n\n*Note: Manual project board column update may be required.*`
            //   });
            // }
